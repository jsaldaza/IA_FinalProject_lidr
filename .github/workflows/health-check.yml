name: ğŸ©º Health Check

on:
  schedule:
    # Ejecuta cada hora durante horas laborales (UTC)
    - cron: "0 8-20 * * 1-5"
  workflow_dispatch: # Permite ejecuciÃ³n manual

jobs:
  health-check:
    name: ğŸ” Check Application Health
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ¥ Check Backend Health
        run: |
          echo "Checking backend health..."
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ secrets.BACKEND_URL }}/health || echo "000")
          if [ "$response" = "200" ]; then
            echo "âœ… Backend is healthy (HTTP $response)"
          else
            echo "âŒ Backend health check failed (HTTP $response)"
            exit 1
          fi

      - name: ğŸŒ Check Frontend
        run: |
          echo "Checking frontend accessibility..."
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ secrets.FRONTEND_URL }} || echo "000")
          if [ "$response" = "200" ]; then
            echo "âœ… Frontend is accessible (HTTP $response)"
          else
            echo "âŒ Frontend check failed (HTTP $response)"
            exit 1
          fi

      - name: ğŸ—„ï¸ Check Database Connectivity
        run: |
          echo "Checking database connectivity through API..."
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ secrets.BACKEND_URL }}/db-test || echo "000")
          if [ "$response" = "200" ]; then
            echo "âœ… Database is connected (HTTP $response)"
          else
            echo "âŒ Database connectivity check failed (HTTP $response)"
            exit 1
          fi

      - name: ğŸ“Š Check API Documentation
        run: |
          echo "Checking API documentation..."
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ secrets.BACKEND_URL }}/api-docs || echo "000")
          if [ "$response" = "200" ] || [ "$response" = "301" ] || [ "$response" = "302" ]; then
            echo "âœ… API docs are accessible (HTTP $response)"
          else
            echo "âš ï¸ API docs check returned (HTTP $response) - might be disabled in production"
          fi

      - name: ğŸ“ Health Summary
        if: always()
        run: |
          echo "ğŸ©º Health Check Summary:"
          echo "========================"
          echo "Backend: ${{ secrets.BACKEND_URL }}"
          echo "Frontend: ${{ secrets.FRONTEND_URL }}"
          echo "Timestamp: $(date)"
          echo "========================"
